<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Algorithms for Matching Bullet Lands â€¢ bulletr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="jquery.sticky-kit.min.js"></script><script src="pkgdown.js"></script><meta property="og:title" content="Algorithms for Matching Bullet Lands">
<meta property="og:description" content="Analyze bullet lands using nonparametric methods. We provide a
    reading routine for x3p files (see &lt;http://www.openfmc.org&gt; for more
    information) and a host of analysis functions designed to assess the
    probability that two bullets were fired from the same gun barrel.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">bulletr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/csafe-isu/bulletr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    

    
    
<div class="contents">

<p>Analyze bullet striations using nonparametric methods</p>
<div id="comparing-two-lands" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#comparing-two-lands" class="anchor"></a>Comparing two lands</h1></div>
<div id="how-to" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to" class="anchor"></a>HOW-TO</h2>
<ol style="list-style-type: decimal">
<li>Load Libraries</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">    <span class="kw">library</span>(dplyr)</a></code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">    <span class="kw">library</span>(bulletr)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">    <span class="kw">library</span>(randomForest)</a></code></pre></div>
<pre><code>## randomForest 4.6-14</code></pre>
<pre><code>## Type rfNews() to see new features/changes/bug fixes.</code></pre>
<pre><code>## 
## Attaching package: 'randomForest'</code></pre>
<pre><code>## The following object is masked from 'package:dplyr':
## 
##     combine</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Read in the bullet file data, and convert to the appropriate x3p format (if necessary):</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">    h44_g1 &lt;-<span class="st"> </span><span class="kw"><a href="reference/read_dat.html">read_dat</a></span>(<span class="st">"~/Downloads/H44-G-1.dat"</span>, <span class="dt">profiley=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   x = col_double(),
##   y = col_double(),
##   value = col_character()
## )</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">    h44_gx1 &lt;-<span class="st"> </span><span class="kw"><a href="reference/read_dat.html">read_dat</a></span>(<span class="st">"~/Downloads/H44-G-2.dat"</span>, <span class="dt">profiley =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   x = col_double(),
##   y = col_double(),
##   value = col_character()
## )</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Get the ideal cross sections</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">    cc_g1 &lt;-<span class="st"> </span><span class="kw"><a href="reference/bulletCheckCrossCut.html">bulletCheckCrossCut</a></span>(<span class="dt">path =</span> <span class="st">"~/Downloads/H44-G-1.dat"</span>, <span class="dt">bullet =</span> h44_g1)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">    cc_gx1 &lt;-<span class="st"> </span><span class="kw"><a href="reference/bulletCheckCrossCut.html">bulletCheckCrossCut</a></span>(<span class="dt">path =</span> <span class="st">"~/Downloads/H44-GX-1.dat"</span>, <span class="dt">bullet =</span> h44_gx1)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"></a>
<a class="sourceLine" id="cb14-4" data-line-number="4">    ccdata_g1 &lt;-<span class="st"> </span><span class="kw"><a href="reference/get_crosscut.html">get_crosscut</a></span>(<span class="dt">bullet =</span> h44_g1, <span class="dt">x =</span> cc_g1) </a>
<a class="sourceLine" id="cb14-5" data-line-number="5">    ccdata_gx1 &lt;-<span class="st"> </span><span class="kw"><a href="reference/get_crosscut.html">get_crosscut</a></span>(<span class="dt">bullet =</span> h44_gx1, <span class="dt">x =</span> cc_gx1)</a></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Get the groove locations</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">    grooves_g1 &lt;-<span class="st"> </span><span class="kw"><a href="reference/get_grooves.html">get_grooves</a></span>(<span class="dt">bullet =</span> ccdata_g1)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">    grooves_gx1 &lt;-<span class="st"> </span><span class="kw"><a href="reference/get_grooves.html">get_grooves</a></span>(<span class="dt">bullet =</span> ccdata_gx1)</a></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Process the bullets to extract LOESS residuals</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">    g1_processed &lt;-<span class="st"> </span><span class="kw">processBullets</span>(<span class="dt">bullet =</span> ccdata_g1,</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">                               <span class="dt">name =</span> <span class="st">"g1"</span>,</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">                               <span class="dt">x =</span> ccdata_g1<span class="op">$</span>x[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">                               <span class="dt">span =</span> <span class="fl">0.75</span>,</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">                               <span class="dt">grooves =</span> grooves_g1<span class="op">$</span>groove)</a>
<a class="sourceLine" id="cb16-6" data-line-number="6"></a>
<a class="sourceLine" id="cb16-7" data-line-number="7">    gx1_processed &lt;-<span class="st"> </span><span class="kw">processBullets</span>(<span class="dt">bullet =</span> ccdata_gx1,</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">                                   <span class="dt">name =</span> <span class="st">"gx1"</span>,</a>
<a class="sourceLine" id="cb16-9" data-line-number="9">                                   <span class="dt">x =</span> ccdata_gx1<span class="op">$</span>x[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb16-10" data-line-number="10">                                   <span class="dt">span =</span> <span class="fl">0.75</span>,</a>
<a class="sourceLine" id="cb16-11" data-line-number="11">                                   <span class="dt">grooves =</span> grooves_gx1<span class="op">$</span>groove)</a></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>Smooth the processed bullet profiles</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">    all_smoothed &lt;-<span class="st"> </span>g1_processed <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="st">        </span><span class="kw">rbind</span>(gx1_processed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="st">        </span><span class="kw"><a href="reference/bulletSmooth.html">bulletSmooth</a></span>(<span class="dt">span =</span> <span class="fl">0.03</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="st">        </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span><span class="kw">is.na</span>(l30))</a></code></pre></div>
<ol start="8" style="list-style-type: decimal">
<li>Detect peaks and valleys in the aligned signatures</li>
</ol>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">    res &lt;-<span class="st"> </span><span class="kw"><a href="reference/bulletGetMaxCMS.html">bulletGetMaxCMS</a></span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_smoothed, bullet <span class="op">==</span><span class="st"> "g1"</span>), </a>
<a class="sourceLine" id="cb18-2" data-line-number="2">                           <span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_smoothed, bullet <span class="op">==</span><span class="st"> "gx1"</span>), </a>
<a class="sourceLine" id="cb18-3" data-line-number="3">                           <span class="dt">column =</span> <span class="st">"l30"</span>, </a>
<a class="sourceLine" id="cb18-4" data-line-number="4">                           <span class="dt">span =</span> <span class="dv">25</span>)</a></code></pre></div>
<ol start="9" style="list-style-type: decimal">
<li>Extract Features</li>
</ol>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">    lofX &lt;-<span class="st"> </span>res<span class="op">$</span>bullets</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">    b12 &lt;-<span class="st"> </span><span class="kw">unique</span>(lofX<span class="op">$</span>bullet)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"></a>
<a class="sourceLine" id="cb19-4" data-line-number="4">    subLOFx1 &lt;-<span class="st"> </span><span class="kw">subset</span>(lofX, bullet<span class="op">==</span>b12[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">    subLOFx2 &lt;-<span class="st"> </span><span class="kw">subset</span>(lofX, bullet<span class="op">==</span>b12[<span class="dv">2</span>]) </a>
<a class="sourceLine" id="cb19-6" data-line-number="6"></a>
<a class="sourceLine" id="cb19-7" data-line-number="7">    ys &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/setops.html">intersect</a></span>(<span class="kw">round</span>(subLOFx1<span class="op">$</span>y, <span class="dt">digits =</span> <span class="dv">3</span>), <span class="kw">round</span>(subLOFx2<span class="op">$</span>y, <span class="dt">digits =</span> <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb19-8" data-line-number="8"></a>
<a class="sourceLine" id="cb19-9" data-line-number="9">    idx1 &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">round</span>(subLOFx1<span class="op">$</span>y, <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">%in%</span><span class="st"> </span>ys)</a>
<a class="sourceLine" id="cb19-10" data-line-number="10">    idx2 &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">round</span>(subLOFx2<span class="op">$</span>y, <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">%in%</span><span class="st"> </span>ys)</a>
<a class="sourceLine" id="cb19-11" data-line-number="11"></a>
<a class="sourceLine" id="cb19-12" data-line-number="12">    g1_inc_x &lt;-<span class="st"> </span>h44_g1<span class="op">$</span>header.info<span class="op">$</span>incrementX</a>
<a class="sourceLine" id="cb19-13" data-line-number="13">    </a>
<a class="sourceLine" id="cb19-14" data-line-number="14">    distr.dist &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>(((subLOFx1<span class="op">$</span>val[idx1] <span class="op">-</span><span class="st"> </span>subLOFx2<span class="op">$</span>val[idx2]) <span class="op">*</span><span class="st"> </span>g1_inc_x <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>)<span class="op">^</span><span class="dv">2</span>, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb19-15" data-line-number="15">    distr.sd &lt;-<span class="st"> </span><span class="kw">sd</span>(subLOFx1<span class="op">$</span>val <span class="op">*</span><span class="st"> </span>g1_inc_x <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>, <span class="dt">na.rm=</span><span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">sd</span>(subLOFx2<span class="op">$</span>val <span class="op">*</span><span class="st"> </span>g1_inc_x <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb19-16" data-line-number="16"></a>
<a class="sourceLine" id="cb19-17" data-line-number="17">    km &lt;-<span class="st"> </span><span class="kw">which</span>(res<span class="op">$</span>lines<span class="op">$</span>match)</a>
<a class="sourceLine" id="cb19-18" data-line-number="18">    knm &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="op">!</span>res<span class="op">$</span>lines<span class="op">$</span>match)</a>
<a class="sourceLine" id="cb19-19" data-line-number="19">    <span class="cf">if</span> (<span class="kw">length</span>(km) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) km &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">length</span>(knm)<span class="op">+</span><span class="dv">1</span>,<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb19-20" data-line-number="20">    <span class="cf">if</span> (<span class="kw">length</span>(knm) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) knm &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">length</span>(km)<span class="op">+</span><span class="dv">1</span>,<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb19-21" data-line-number="21"></a>
<a class="sourceLine" id="cb19-22" data-line-number="22">    signature.length &lt;-<span class="st"> </span><span class="kw">min</span>(<span class="kw">nrow</span>(subLOFx1), <span class="kw">nrow</span>(subLOFx2))</a>
<a class="sourceLine" id="cb19-23" data-line-number="23"></a>
<a class="sourceLine" id="cb19-24" data-line-number="24">    doublesmoothed &lt;-<span class="st"> </span>lofX <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-25" data-line-number="25"><span class="st">      </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(y) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-26" data-line-number="26"><span class="st">      </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">avgl30 =</span> <span class="kw">mean</span>(l30, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-27" data-line-number="27"><span class="st">      </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-28" data-line-number="28"><span class="st">      </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">smoothavgl30 =</span> <span class="kw"><a href="reference/smoothloess.html">smoothloess</a></span>(<span class="dt">x =</span> y, <span class="dt">y =</span> avgl30, <span class="dt">span =</span> <span class="fl">0.3</span>),</a>
<a class="sourceLine" id="cb19-29" data-line-number="29">             <span class="dt">l50 =</span> l30 <span class="op">-</span><span class="st"> </span>smoothavgl30)</a>
<a class="sourceLine" id="cb19-30" data-line-number="30"></a>
<a class="sourceLine" id="cb19-31" data-line-number="31">    final_doublesmoothed &lt;-<span class="st"> </span>doublesmoothed <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-32" data-line-number="32"><span class="st">      </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">round</span>(y, <span class="dt">digits =</span> <span class="dv">3</span>) <span class="op">%in%</span><span class="st"> </span>ys)</a>
<a class="sourceLine" id="cb19-33" data-line-number="33"></a>
<a class="sourceLine" id="cb19-34" data-line-number="34">    rough_cor &lt;-<span class="st"> </span><span class="kw">cor</span>(<span class="kw">na.omit</span>(final_doublesmoothed<span class="op">$</span>l50[final_doublesmoothed<span class="op">$</span>bullet <span class="op">==</span><span class="st"> </span>b12[<span class="dv">1</span>]]), </a>
<a class="sourceLine" id="cb19-35" data-line-number="35">                     <span class="kw">na.omit</span>(final_doublesmoothed<span class="op">$</span>l50[final_doublesmoothed<span class="op">$</span>bullet <span class="op">==</span><span class="st"> </span>b12[<span class="dv">2</span>]]),</a>
<a class="sourceLine" id="cb19-36" data-line-number="36">                     <span class="dt">use =</span> <span class="st">"pairwise.complete.obs"</span>)</a>
<a class="sourceLine" id="cb19-37" data-line-number="37"></a>
<a class="sourceLine" id="cb19-38" data-line-number="38">    ccf_temp &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb19-39" data-line-number="39">      <span class="dt">ccf=</span>res<span class="op">$</span>ccf, </a>
<a class="sourceLine" id="cb19-40" data-line-number="40">      <span class="dt">rough_cor =</span> rough_cor, </a>
<a class="sourceLine" id="cb19-41" data-line-number="41">      <span class="dt">lag=</span>res<span class="op">$</span>lag <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb19-42" data-line-number="42">      <span class="dt">D=</span>distr.dist, </a>
<a class="sourceLine" id="cb19-43" data-line-number="43">      <span class="dt">sd_D =</span> distr.sd,</a>
<a class="sourceLine" id="cb19-44" data-line-number="44">      <span class="dt">b1=</span>b12[<span class="dv">1</span>], <span class="dt">b2=</span>b12[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb19-45" data-line-number="45">      <span class="dt">signature_length =</span> signature.length <span class="op">*</span><span class="st"> </span>g1_inc_x <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb19-46" data-line-number="46">      <span class="dt">overlap =</span> <span class="kw">length</span>(ys) <span class="op">/</span><span class="st"> </span>signature.length,</a>
<a class="sourceLine" id="cb19-47" data-line-number="47">      <span class="dt">matches =</span> <span class="kw">sum</span>(res<span class="op">$</span>lines<span class="op">$</span>match) <span class="op">*</span><span class="st"> </span>(<span class="dv">1000</span> <span class="op">/</span><span class="st"> </span>g1_inc_x) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(ys),</a>
<a class="sourceLine" id="cb19-48" data-line-number="48">      <span class="dt">mismatches =</span> <span class="kw">sum</span>(<span class="op">!</span>res<span class="op">$</span>lines<span class="op">$</span>match) <span class="op">*</span><span class="st"> </span><span class="dv">1000</span> <span class="op">/</span><span class="st"> </span><span class="kw">abs</span>(<span class="kw">diff</span>(<span class="kw">range</span>(<span class="kw">c</span>(subLOFx1<span class="op">$</span>y, subLOFx2<span class="op">$</span>y)))),</a>
<a class="sourceLine" id="cb19-49" data-line-number="49">      <span class="dt">cms =</span> res<span class="op">$</span>maxCMS <span class="op">*</span><span class="st"> </span>(<span class="dv">1000</span> <span class="op">/</span><span class="st"> </span>g1_inc_x) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(ys),</a>
<a class="sourceLine" id="cb19-50" data-line-number="50">      <span class="dt">cms2 =</span> bulletr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/bulletr/topics/maxCMS">maxCMS</a></span>(<span class="kw">subset</span>(res<span class="op">$</span>lines, type<span class="op">==</span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(type))<span class="op">$</span>match) <span class="op">*</span><span class="st"> </span>(<span class="dv">1000</span> <span class="op">/</span><span class="st"> </span>g1_inc_x) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(ys),</a>
<a class="sourceLine" id="cb19-51" data-line-number="51">      <span class="dt">non_cms =</span> bulletr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/bulletr/topics/maxCMS">maxCMS</a></span>(<span class="op">!</span>res<span class="op">$</span>lines<span class="op">$</span>match) <span class="op">*</span><span class="st"> </span><span class="dv">1000</span> <span class="op">/</span><span class="st"> </span><span class="kw">abs</span>(<span class="kw">diff</span>(<span class="kw">range</span>(<span class="kw">c</span>(subLOFx1<span class="op">$</span>y, subLOFx2<span class="op">$</span>y)))),</a>
<a class="sourceLine" id="cb19-52" data-line-number="52">      <span class="dt">left_cms =</span> <span class="kw">max</span>(knm[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>km[<span class="dv">1</span>], <span class="dv">0</span>) <span class="op">*</span><span class="st"> </span>(<span class="dv">1000</span> <span class="op">/</span><span class="st"> </span>g1_inc_x) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(ys),</a>
<a class="sourceLine" id="cb19-53" data-line-number="53">      <span class="dt">right_cms =</span> <span class="kw">max</span>(km[<span class="kw">length</span>(km)] <span class="op">-</span><span class="st"> </span>knm[<span class="kw">length</span>(knm)],<span class="dv">0</span>) <span class="op">*</span><span class="st"> </span>(<span class="dv">1000</span> <span class="op">/</span><span class="st"> </span>g1_inc_x) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(ys),</a>
<a class="sourceLine" id="cb19-54" data-line-number="54">      <span class="dt">left_noncms =</span> <span class="kw">max</span>(km[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>knm[<span class="dv">1</span>], <span class="dv">0</span>) <span class="op">*</span><span class="st"> </span><span class="dv">1000</span> <span class="op">/</span><span class="st"> </span><span class="kw">abs</span>(<span class="kw">diff</span>(<span class="kw">range</span>(<span class="kw">c</span>(subLOFx1<span class="op">$</span>y, subLOFx2<span class="op">$</span>y)))),</a>
<a class="sourceLine" id="cb19-55" data-line-number="55">      <span class="dt">right_noncms =</span> <span class="kw">max</span>(knm[<span class="kw">length</span>(knm)]<span class="op">-</span>km[<span class="kw">length</span>(km)],<span class="dv">0</span>) <span class="op">*</span><span class="st"> </span><span class="dv">1000</span> <span class="op">/</span><span class="st"> </span><span class="kw">abs</span>(<span class="kw">diff</span>(<span class="kw">range</span>(<span class="kw">c</span>(subLOFx1<span class="op">$</span>y, subLOFx2<span class="op">$</span>y)))),</a>
<a class="sourceLine" id="cb19-56" data-line-number="56">      <span class="dt">sum_peaks =</span> <span class="kw">sum</span>(<span class="kw">abs</span>(res<span class="op">$</span>lines<span class="op">$</span>heights[res<span class="op">$</span>lines<span class="op">$</span>match])) <span class="op">*</span><span class="st"> </span>(<span class="dv">1000</span> <span class="op">/</span><span class="st"> </span>g1_inc_x) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(ys)</a>
<a class="sourceLine" id="cb19-57" data-line-number="57">    )</a>
<a class="sourceLine" id="cb19-58" data-line-number="58"></a>
<a class="sourceLine" id="cb19-59" data-line-number="59">    ccf &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">as.data.frame</span>(ccf_temp)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-60" data-line-number="60"><span class="st">      </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-61" data-line-number="61"><span class="st">      </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="dt">profile1_id =</span> b1, <span class="dt">profile2_id =</span> b2, ccf, rough_cor, lag, D, sd_D, signature_length, overlap,</a>
<a class="sourceLine" id="cb19-62" data-line-number="62">                    matches, mismatches, cms, non_cms, sum_peaks)</a>
<a class="sourceLine" id="cb19-63" data-line-number="63">    ccf[,<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)] &lt;-<span class="st"> </span><span class="kw">lapply</span>(ccf[,<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)], <span class="cf">function</span>(x) { <span class="kw">as.numeric</span>(<span class="kw">as.character</span>(x)) })</a></code></pre></div>
<ol start="10" style="list-style-type: decimal">
<li>Get Predicted Probability of Match</li>
</ol>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">    ccf<span class="op">$</span>forest &lt;-<span class="st"> </span><span class="kw">predict</span>(rtrees, <span class="dt">newdata =</span> ccf, <span class="dt">type =</span> <span class="st">"prob"</span>)[,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">ccf<span class="op">$</span>forest</a></code></pre></div>
<pre><code>## [1] 0.16</code></pre>
<p>An interactive interface for doing comparisons is available <a href="https://oaiti.org/apps/bulletmatcher/" class="uri">https://oaiti.org/apps/bulletmatcher/</a></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2 class="hasAnchor">
<a href="#sidebar" class="anchor"></a>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cran.r-project.org/package=bulletr">https://â€‹cran.r-project.org/â€‹package=bulletr</a>
</li>
<li>Browse source code at <br><a href="https://github.com/csafe-isu/bulletr">https://â€‹github.com/â€‹csafe-isu/â€‹bulletr</a>
</li>
<li>Report a bug at <br><a href="https://github.com/csafe-isu/bulletr/issues">https://â€‹github.com/â€‹csafe-isu/â€‹bulletr/â€‹issues</a>
</li>
</ul>
<h2>License</h2>
<p><a href="https://opensource.org/licenses/mit-license.php">MIT</a></p>
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Eric Hare <br><small class="roles"> Author, maintainer </small> </li>
<li>Heike Hofmann <br><small class="roles"> Author </small> </li>
<li>Ganesh Krishnan <br><small class="roles"> Author </small> </li>
</ul>
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=bulletr"><img src="http://www.r-pkg.org/badges/version/bulletr" alt="CRAN Status"></a></li>
<li><a href="http://www.r-pkg.org/pkg/bulletr"><img src="http://cranlogs.r-pkg.org/badges/bulletr" alt="CRAN RStudio mirror downloads"></a></li>
<li><a href="http://www.repostatus.org/#active"><img src="http://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active â€“ The project has reached a stable, usable state and is being actively developed."></a></li>
<li><a href="https://travis-ci.org/isu-csafe/bulletr"><img src="https://travis-ci.org/heike/bulletr.svg?branch=master" alt="Travis-CI Build Status"></a></li>
<li><a href="/commits/master"><img src="https://img.shields.io/badge/last%20change-2018--07--02-yellowgreen.svg" alt="Last-changedate"></a></li>
</ul>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Eric Hare, Heike Hofmann, Ganesh Krishnan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
